<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>פתק ה-Notes — PDF + גלריה</title>
  <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Assistant:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/styles.css" />
  <style>
    .pdf-wrap{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:0 10px 24px var(--shadow);overflow:hidden}
    .pdf-tools{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;background:#fff9ef;border-bottom:1px solid var(--border)}
    .pdf-frame{width:100%;height:80vh;border:0;display:block}
    .btn-ghost{background:#fff;border:1px solid var(--border);border-radius:8px;padding:.45rem .7rem;text-decoration:none;color:inherit}
    .rich-note{display:none} /* תפעילו אם תרצו להשתמש בזיהוי Place/Date מתוכן HTML */
  </style>
</head>
<body class="bg-paper">
  <header class="site-header">
    <h1 class="brand">פתק ה-Notes</h1>
    <p class="tagline">גרסת PDF שנוצרה מהאייפון + אפשרות גלריה חכמה</p>
  </header>

  <main class="container">
    <!-- תצוגת ה-PDF -->
    <section class="pdf-wrap" aria-label="Notes PDF viewer">
      <div class="pdf-tools">
        <strong>תצוגת PDF</strong>
        <div>
          <a class="btn-ghost" href="../../assets/notes/grandpa-note.pdf" download>הורדה</a>
          <a class="btn" href="../../index.html">חזרה למדף</a>
        </div>
      </div>
      <iframe class="pdf-frame" src="../../assets/notes/grandpa-note.pdf"></iframe>
    </section>

    <!-- אופציונלי: הדביקו כאן תוכן HTML מהפתק (טקסט + IMG). הקוד יזהה Place/Date ויציג כותרות יפות. -->
    <section class="rich-note" id="rich-note" style="margin-top:28px">
      <!-- דוגמה (להסרה/החלפה):
      <p>Place: Budapest</p>
      <p>Date: 1993</p>
      <p>Some paragraph from the note…</p>
      <p><img src="../../assets/notes/example-photo.jpg" alt="Budapest view"></p>

      <p>Place: Vienna</p>
      <p>Date: 1993-10-10</p>
      <p><img src="../../assets/notes/example-photo2.jpg" alt="Vienna view"></p>
      -->
    </section>

    <!-- גלריית התוצאות (נבנית אוטומטית אם השתמשתם ב-rich-note) -->
    <section id="note-gallery" class="note-gallery" style="margin-top:20px"></section>
  </main>

  <script>
    // ===== זיהוי "Place: ..." ו-"Date: ..." לפני תמונה =====
    // עובד רק על התוכן שתדביקו בתוך .rich-note (לא מתוך PDF)
    (function(){
      const src = document.getElementById('rich-note');
      if(!src) return;
      const gallery = document.getElementById('note-gallery');
      const items = [];

      // נעבור על הצאצאים בסדר, ונאסוף רצפים של Place/Date/IMG
      let pending = {place:null,date:null};
      [...src.children].forEach(node=>{
        if(node.tagName === 'P'){
          const txt = (node.textContent || '').trim();
          const img = node.querySelector('img');

          const placeMatch = /^Place:\s*(.+)$/i.exec(txt);
          const dateMatch  = /^Date:\s*(.+)$/i.exec(txt);

          if(placeMatch){ pending.place = placeMatch[1]; return; }
          if(dateMatch) { pending.date  = dateMatch[1];  return; }

          if(img){
            // יש תמונה — צור פריט גלריה עם מה שנצבר
            items.push({
              src: img.getAttribute('src'),
              alt: img.getAttribute('alt') || '',
              place: pending.place || null,
              date: pending.date || null
            });
            // אפס אחרי שימוש (כדי שלא ידלוף לשאר תמונות)
            pending = {place:null,date:null};
          }
        }
      });

      // בנה כרטיסים
      items.forEach(it=>{
        const card = document.createElement('article');
        card.className = 'note-card';
        const im = document.createElement('img');
        im.src = it.src; im.alt = it.alt;
        const meta = document.createElement('div');
        meta.className = 'note-meta';

        if(it.place){ const p = document.createElement('span'); p.className='pill'; p.textContent = `Place: ${it.place}`; meta.appendChild(p); }
        if(it.date ){ const d = document.createElement('span'); d.className='pill'; d.textContent = `Date: ${it.date}`;  meta.appendChild(d); }

        card.appendChild(im);
        if(meta.children.length) card.appendChild(meta);
        gallery.appendChild(card);
      });

      // הצג אזור הגלריה רק אם יש פריטים
      if(items.length){ src.style.display='none'; gallery.style.display='grid'; }
    })();
  </script>
</body>
</html>